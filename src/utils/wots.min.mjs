function sha256(r){function t(r,t){return r>>>t|r<<32-t}for(var n,a,o=Math.pow,e=o(2,32),_=[],s=8*r.length,u=sha256.h=sha256.h||[],h=sha256.k=sha256.k||[],S=h.length,i={},A=2;S<64;A++)if(!i[A]){for(n=0;n<313;n+=A)i[n]=A;u[S]=o(A,.5)*e|0,h[S++]=o(A,1/3)*e|0}for(r+="Â€";r.length%64-56;)r+="\0";for(n=0;n<r.length;n++){if((a=r.charCodeAt(n))>>8)return;_[n>>2]|=a<<(3-n)%4*8}for(_[_.length]=s/e|0,_[_.length]=s,a=0;a<_.length;){var f=_.slice(a,a+=16),c=u;for(u=u.slice(0,8),n=0;n<64;n++){var y=f[n-15],p=f[n-2],l=u[0],d=u[4],N=u[7]+(t(d,6)^t(d,11)^t(d,25))+(d&u[5]^~d&u[6])+h[n]+(f[n]=n<16?f[n]:f[n-16]+(t(y,7)^t(y,18)^y>>>3)+f[n-7]+(t(p,17)^t(p,19)^p>>>10)|0);(u=[N+((t(l,2)^t(l,13)^t(l,22))+(l&u[1]^l&u[2]^u[1]&u[2]))|0].concat(u))[4]=u[4]+N|0}for(n=0;n<8;n++)u[n]=u[n]+c[n]|0}var v=[];for(n=0;n<8;n++)for(a=3;a+1;a--){var W=u[n]>>8*a&255;v.push(W),W.toString(16)}return v}function bArr_toString(r){for(var t="",n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t}Array.prototype.toASCII=function(){for(var r="",t=0;t<this.length;t++)r+=String.fromCharCode(this[t]);return r},String.prototype.toBytes=function(){for(var r=[],t=0;t<this.length;t++)r.push(this.charCodeAt(t));return r},Array.prototype.pushArray=function(r){this.push.apply(this,r)};var PARAMSN=32,WOTSW=16,WOTSLOGW=4,WOTSLEN1=8*PARAMSN/WOTSLOGW,WOTSLEN2=3,WOTSLEN=WOTSLEN1+WOTSLEN2,WOTSSIGBYTES=WOTSLEN*PARAMSN,TXSIGLEN=2144,TXADDRLEN=2208,XMSS_HASH_PADDING_F=0,XMSS_HASH_PADDING_PRF=3;function wots_public_key_gen(r,t,n){for(var a=bytes_to_addr(n),o=expand_seed(r),e=[],_=0;_<WOTSLEN;_++){set_chain_addr(_,a);var s=gen_chain(o.slice(_*PARAMSN,PARAMSN+_*PARAMSN),0,WOTSW-1,t,a);e.pushArray(s)}return e}function wots_sign(r,t,n,a){var o,e=bytes_to_addr(a),_=[];o=chain_lenghts(r);for(var s=expand_seed(t),u=0;u<WOTSLEN;u++){set_chain_addr(u,e);var h=gen_chain(s.slice(u*PARAMSN,PARAMSN+u*PARAMSN),0,o[u],n,e);_.pushArray(h)}return _}function wots_publickey_from_sig(r,t,n,a){var o,e=bytes_to_addr(a);o=chain_lenghts(t);for(var _=[],s=0;s<WOTSLEN;s++){set_chain_addr(s,e);var u=r.slice(s*PARAMSN,PARAMSN+s*PARAMSN);_.pushArray(gen_chain(u,o[s],WOTSW-1-o[s],n,e))}return _}function expand_seed(r){for(var t=[],n=[],a=0;a<WOTSLEN;a++)t=ull_to_bytes(PARAMSN,[a]),n.pushArray(prf(t,r));return n}function ull_to_bytes(r,t){for(var n=[],a=r-1;a>=0;a--){var o=t[a];null==o?n.push(0):n.push(o)}return n}function prf(r,t){var n=[];n=ull_to_bytes(PARAMSN,[XMSS_HASH_PADDING_PRF]);var a=byte_copy(t,PARAMSN);n.pushArray(a);var o=byte_copy(r,32);return n.pushArray(o),sha256(n.toASCII())}function t_hash(r,t,n){var a=[];a=ull_to_bytes(PARAMSN,[XMSS_HASH_PADDING_F]);set_key_and_mask(0,n);var o=prf(addr_to_bytes(n),t);a.pushArray(o),set_key_and_mask(1,n);for(var e=prf(addr_to_bytes(n),t),_=[],s=0;s<PARAMSN;s++)_.push(r[s]^e[s]);return a.pushArray(_),sha256(a.toASCII())}function byte_copy(r,t){for(var n=[],a=0;a<t;a++)null==r[a]?n.push(0):n.push(r[a]);return n}function gen_chain(r,t,n,a,o){for(var e=byte_copy(r,PARAMSN),_=t;_<t+n&&_<WOTSW;_++)set_hash_addr(_,o),e=t_hash(e,a,o);return e}function base_w(r,t){for(var n,a=0,o=0,e=0,_=[],s=0;s<r;s++)0==e&&(n=t[a],a++,e+=8),e-=WOTSLOGW,_[o]=n>>e&WOTSW-1,o++;return _}function wots_checksum(r){for(var t,n=0,a=0;a<WOTSLEN1;a++)n+=WOTSW-1-r[a];return t=ull_to_bytes(Math.round((WOTSLEN2*WOTSLOGW+7)/8),from_int_to_byte_array(n)),base_w(WOTSLEN2,t)}function chain_lenghts(r){var t=base_w(WOTSLEN1,r);return t.pushArray(wots_checksum(t)),t}function set_chain_addr(r,t){t[5]=[0,0,0,r]}function set_hash_addr(r,t){t[6]=[0,0,0,r]}function set_key_and_mask(r,t){t[7]=[0,0,0,r]}function from_int_to_byte_array(r){var t=[];for(0==r&&t.push(r);0!=r;)t.push(255&r),r>>=8;return t}function addr_to_bytes(r){for(var t=[],n=0;n<8;n++){null==r[n.toString()]&&(r[n.toString()]=[0,0,0,0]);var a=r[n.toString()];t.pushArray(a)}return t}function bytes_to_addr(r){for(var t={0:[0,0,0,0],1:[0,0,0,0],2:[0,0,0,0],3:[0,0,0,0],4:[0,0,0,0],5:[0,0,0,0],6:[0,0,0,0],7:[0,0,0,0]},n=0;n<8;n++)t[n.toString()]=ull_to_bytes(4,r.slice(4*n,4*n+4));return t}export{wots_public_key_gen,wots_sign,wots_publickey_from_sig};
